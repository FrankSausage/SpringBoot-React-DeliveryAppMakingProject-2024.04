{"version":3,"file":"opening_hours.js","sourceRoot":"","sources":["../../src/utils/opening_hours.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Place} from './googlemaps_types.js';\n\nconst ONE_DAY_IN_MS = 24 * 60 * 60 * 1000;\nconst ONE_WEEK_IN_MS = 7 * ONE_DAY_IN_MS;\n\ntype OpeningHours = google.maps.places.OpeningHours;\ntype OpeningHoursPeriod = google.maps.places.OpeningHoursPeriod;\ntype OpeningHoursPoint = google.maps.places.OpeningHoursPoint;\n\n/**\n * Formats a relative point in time according to the browser's locale format.\n */\nfunction formatPointTime(\n    point: OpeningHoursPoint, includeWeekday = false): string {\n  // Choose an arbitrary `Date`, then set the fields needed for formatting\n  // (weekday and time).\n  const date = new Date();\n  date.setDate(date.getDate() - date.getDay() + point.day);\n  date.setHours(point.hour);\n  date.setMinutes(point.minute);\n  date.setSeconds(0);\n\n  return date.toLocaleString(\n      /* locales= */ undefined, {\n        hour: 'numeric',\n        minute: 'numeric',\n        weekday: includeWeekday ? 'short' : undefined\n      });\n}\n\n/**\n * Formats a relative point in time (specified in the Place's TZ), usually\n * including the weekday. However, if the point in time, as an absolute\n * timestamp, occurs within the next 24 hours, hide the weekday.\n *\n * @param point The relative time from the Places API (weekday, hour, minute)\n * @param absolutePoint The instant in time corresponding to `point`, i.e. a\n *     `Date` object\n * @param now Used to determine if `absolutePoint` is coming soon\n */\nexport function formatTimeWithWeekdayMaybe(\n    point: OpeningHoursPoint, absolutePoint: Date, now = new Date()): string {\n  return formatPointTime(point, !isSoon(absolutePoint, now));\n}\n\n/**\n * Returns whether the given date is in the future and soon approaching. \"Soon\"\n * means sooner than the `intervalMs` argument (default 24 hours).\n */\nexport function isSoon(\n    date: Date, now = new Date(), intervalMs = ONE_DAY_IN_MS): boolean {\n  return ((date >= now) && ((date.valueOf() - now.valueOf()) < intervalMs));\n}\n\n/** Detects if a Place is declared as always open. */\nfunction isPlaceAlwaysOpen(openingHours: OpeningHours): boolean {\n  return (\n      (openingHours.periods?.length === 1) && !openingHours.periods[0].close &&\n      (openingHours.periods[0].open.day === 0) &&\n      (openingHours.periods[0].open.hour === 0) &&\n      (openingHours.periods[0].open.minute === 0));\n}\n\n/** Gets the date components of the most recent Sunday (relative to UTC). */\nfunction getLastSundayUTC(date: Date):\n    {year: number, month: number, day: number} {\n  const sundayUTC = new Date(date);\n  sundayUTC.setUTCDate(sundayUTC.getUTCDate() - sundayUTC.getUTCDay());\n  return {\n    year: sundayUTC.getUTCFullYear(),\n    month: sundayUTC.getUTCMonth(),\n    day: sundayUTC.getUTCDate(),\n  };\n}\n\n/**\n * From all occurrences of \"Sunday at 00:00\" in the Place's timezone, return\n * the most recent one prior to `now`.\n */\nfunction getLastSundayInPlaceTimezone(\n    now: Date, utcOffsetMinutes: number): Date {\n  const {year, month, day} = getLastSundayUTC(now);\n  let placeSundayStart = Date.UTC(year, month, day, 0, -utcOffsetMinutes);\n\n  // Because of the offset, `placeSundayStart` could be after `now` or more\n  // than 7 days before it. Increment as necessary.\n  const deltaBeforeNowMs = now.valueOf() - placeSundayStart;\n  if (deltaBeforeNowMs < 0) {\n    placeSundayStart -= ONE_WEEK_IN_MS;\n  } else if (deltaBeforeNowMs >= ONE_WEEK_IN_MS) {\n    placeSundayStart += ONE_WEEK_IN_MS;\n  }\n  return new Date(placeSundayStart);\n}\n\n/**\n * Converts a relative `OpeningHoursPoint` object into an absolute timestamp,\n * indexed off of `placeSundayStart`.\n */\nfunction getPointDate(point: OpeningHoursPoint, placeSundayStart: Date): Date {\n  const pointDate = new Date(placeSundayStart);\n  pointDate.setDate(pointDate.getDate() + point.day);\n  pointDate.setHours(pointDate.getHours() + point.hour);\n  pointDate.setMinutes(pointDate.getMinutes() + point.minute);\n  return pointDate;\n}\n\n/**\n * Finds the currently active Opening Hours Period, if any, along with its\n * absolute open and closing timestamps.\n */\nfunction getCurrentPeriod(\n    openingHours: OpeningHours, utcOffsetMinutes: number, now = new Date()):\n    {period?: OpeningHoursPeriod, openDate?: Date, closeDate?: Date} {\n  const lastSundayStart = getLastSundayInPlaceTimezone(now, utcOffsetMinutes);\n\n  for (const period of openingHours.periods) {\n    const stats = {\n      period,\n      openDate: getPointDate(period.open, lastSundayStart),\n      closeDate: period.close ? getPointDate(period.close, lastSundayStart) :\n                                undefined\n    };\n    if (!stats.closeDate) {\n      return stats;\n    }\n\n    // In situations where the local close time appears earlier than the open\n    // time, e.g. \"Opens Saturday (6), closes Sunday (0)\", create a forward\n    // interval.\n    if (stats.closeDate < stats.openDate) {\n      if (stats.openDate > now) {\n        stats.openDate.setDate(stats.openDate.getDate() - 7);\n      } else {\n        stats.closeDate.setDate(stats.closeDate.getDate() + 7);\n      }\n    }\n\n    if ((now >= stats.openDate) && (now < stats.closeDate)) {\n      return stats;\n    }\n  }\n  return {};\n}\n\n/** Status indicator for an upcoming close time. */\nexport enum NextCloseTimeStatus {\n  UNKNOWN,\n  ALWAYS_OPEN,\n  NOT_OPEN_NOW,\n  WILL_CLOSE\n}\n\ninterface UpcomingCloseTimeResult {\n  status: NextCloseTimeStatus;\n  closePoint?: OpeningHoursPoint;\n  closeDate?: Date;\n}\n\n/**\n * Finds the next closing time of a Place, returning it (if present) and a\n * status flag.\n *\n * Does not take into account exceptional hours (such as holidays) or business\n * status.\n */\nexport function getUpcomingCloseTime(\n    place: Place, now = new Date()): UpcomingCloseTimeResult {\n  if (!place.regularOpeningHours || place.utcOffsetMinutes == null) {\n    return {status: NextCloseTimeStatus.UNKNOWN};\n  } else if (isPlaceAlwaysOpen(place.regularOpeningHours)) {\n    return {status: NextCloseTimeStatus.ALWAYS_OPEN};\n  }\n\n  const currentPeriod =\n      getCurrentPeriod(place.regularOpeningHours, place.utcOffsetMinutes, now);\n  if (!currentPeriod.period) {\n    return {status: NextCloseTimeStatus.NOT_OPEN_NOW};\n  } else if (!currentPeriod.closeDate) {\n    // This should not happen unless we receive malformed data; \"always open\"\n    // should be caught by the `isPlaceAlwaysOpen()` check above.\n    return {status: NextCloseTimeStatus.ALWAYS_OPEN};\n  }\n\n  return {\n    status: NextCloseTimeStatus.WILL_CLOSE,\n    closeDate: currentPeriod.closeDate,\n\n    // Always defined if `currentPeriod.closeDate` is\n    closePoint: currentPeriod.period.close!,\n  };\n}\n\n/** Status indicator for an upcoming opening time. */\nexport enum NextOpenTimeStatus {\n  UNKNOWN,\n  NEVER_OPEN,\n  ALREADY_OPEN,\n  WILL_OPEN\n}\n\ninterface UpcomingOpenTimeResult {\n  status: NextOpenTimeStatus;\n  openPoint?: OpeningHoursPoint;\n  openDate?: Date;\n}\n\n/**\n * Finds the next open time of a Place, returning it (if present) and a\n * status flag.\n *\n * Does not take into account exceptional hours (such as holidays) or business\n * status.\n */\nexport function getUpcomingOpenTime(\n    place: Place, now = new Date()): UpcomingOpenTimeResult {\n  if (!place.regularOpeningHours || place.utcOffsetMinutes == null) {\n    return {status: NextOpenTimeStatus.UNKNOWN};\n  } else if (isPlaceAlwaysOpen(place.regularOpeningHours)) {\n    return {status: NextOpenTimeStatus.ALREADY_OPEN};\n  }\n\n  const lastSundayStart =\n      getLastSundayInPlaceTimezone(now, place.utcOffsetMinutes);\n  const bestResult: UpcomingOpenTimeResult = {\n    status: NextOpenTimeStatus.NEVER_OPEN,\n  };\n  let closestOpenInterval = Infinity;\n  for (const period of place.regularOpeningHours.periods) {\n    const openDate = getPointDate(period.open, lastSundayStart);\n    if (!period.close) {\n      return {status: NextOpenTimeStatus.ALREADY_OPEN};\n    }\n    const closeDate = getPointDate(period.close, lastSundayStart);\n    if ((closeDate >= openDate) && (now >= openDate) && (now < closeDate)) {\n      return {status: NextOpenTimeStatus.ALREADY_OPEN};\n    } else if (\n        (closeDate < openDate) && !((now >= closeDate) && (now < openDate))) {\n      return {status: NextOpenTimeStatus.ALREADY_OPEN};\n    }\n\n    // Make sure openDate is in the future\n    if (openDate < now) {\n      openDate.setDate(openDate.getDate() + 7);\n    }\n    const interval = openDate.valueOf() - now.valueOf();\n    if (interval < closestOpenInterval) {\n      closestOpenInterval = interval;\n      bestResult.status = NextOpenTimeStatus.WILL_OPEN;\n      bestResult.openPoint = period.open;\n      bestResult.openDate = openDate;\n    }\n  }\n  return bestResult;\n}\n\n/**\n * Temporary (until Place is GA) replacement for the built-in isOpen() method.\n */\nexport function isOpen(place: Place, now = new Date()): boolean|undefined {\n  if (!place.regularOpeningHours || place.utcOffsetMinutes == null) {\n    return undefined;\n  } else if (isPlaceAlwaysOpen(place.regularOpeningHours)) {\n    return true;\n  }\n  const {period} =\n      getCurrentPeriod(place.regularOpeningHours, place.utcOffsetMinutes, now);\n  return !!period;\n}"]}