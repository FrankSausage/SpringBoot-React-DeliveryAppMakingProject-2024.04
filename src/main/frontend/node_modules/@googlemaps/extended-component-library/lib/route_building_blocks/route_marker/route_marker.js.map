{"version":3,"file":"route_marker.js","sourceRoot":"","sources":["../../../src/route_building_blocks/route_marker/route_marker.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {html, PropertyValues} from 'lit';\nimport {customElement, property} from 'lit/decorators.js';\n\nimport {APILoader} from '../../api_loader/api_loader.js';\nimport {Deferred} from '../../utils/deferred.js';\nimport {AdvancedMarkerElement} from '../../utils/googlemaps_types.js';\nimport {MapController} from '../map_controller.js';\nimport {RouteDataConsumer} from '../route_data_consumer.js';\n\ninterface MarkerLibrary {\n  // tslint:disable-next-line:enforce-name-casing\n  AdvancedMarkerElement: typeof google.maps.marker.AdvancedMarkerElement;\n}\n\n/**\n * Renders a marker indicating the origin or destination of a route.\n *\n * @slot - An element to be used as custom marker content on the map. The\n * element will be detached from the DOM and moved into the map's\n * implementation.\n */\n@customElement('gmpx-route-marker')\nexport class RouteMarker extends RouteDataConsumer {\n  /**\n   * Which waypoint of the route to position the marker on. For now, this is\n   * either \"origin\" or \"destination\"; intermediate waypoints are not yet\n   * supported.\n   */\n  @property({type: String, reflect: true})\n  waypoint: 'origin'|'destination' = 'origin';\n\n  /**\n   * Rollover text for the marker, displayed on mouse hover.\n   */\n  @property({type: String, reflect: true}) override title = '';\n\n  /**\n   * The z-index of the marker relative to other Advanced Markers.\n   */\n  @property({type: Number, attribute: false}) zIndex?: number;\n\n  private readonly innerMarkerDeferred = new Deferred<AdvancedMarkerElement>();\n\n  /**\n   * The inner `google.maps.marker.AdvancedMarkerElement` from the Maps JS API.\n   * This value is set once `innerMarkerPromise` is resolved.\n   */\n  get innerMarker(): AdvancedMarkerElement|undefined {\n    return this.innerMarkerDeferred.value;\n  }\n\n  /**\n   * Resolves to the inner marker when it's ready. It might not be ready\n   * immediately becasue the `AdvancedMarkerElement` class is loaded\n   * asynchronously from the Maps JS API.\n   */\n  get innerMarkerPromise(): Promise<AdvancedMarkerElement> {\n    return this.innerMarkerDeferred.promise;\n  }\n\n  private readonly mapController = new MapController(this);\n\n  constructor() {\n    super();\n    this.initMarker();\n  }\n\n  private async initMarker() {\n    const {AdvancedMarkerElement} =\n        await APILoader.importLibrary('marker', this) as unknown as\n        MarkerLibrary;\n    const marker = new AdvancedMarkerElement();\n    this.innerMarkerDeferred.resolve(marker);\n  }\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    const map = await this.mapController.mapPromise;\n    const marker = await this.innerMarkerPromise;\n    // Make sure the component hasn't been disconnected while awaiting\n    if (this.isConnected) marker.map = map;\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this.innerMarker) this.innerMarker.map = null;\n  }\n\n  protected override render() {\n    return html`<slot @slotchange=${this.onSlotChange}></slot>`;\n  }\n\n  protected override updated(changedProperties: PropertyValues<this>) {\n    if (changedProperties.has('waypoint') || changedProperties.has('route') ||\n        changedProperties.has('contextRoute')) {\n      this.updatePosition();\n    }\n    if (changedProperties.has('title')) this.updateTitle();\n    if (changedProperties.has('zIndex')) this.updateZIndex();\n  }\n\n  private async updatePosition() {\n    const marker = await this.innerMarkerPromise;\n    const route = this.getRoute();\n    if (!route?.legs?.length) {\n      marker.position = null;\n      return;\n    }\n    const firstLeg = route.legs[0];\n    const lastLeg = route.legs[route.legs.length - 1];\n    if (!this.waypoint || this.waypoint === 'origin') {\n      marker.position = firstLeg.start_location;\n    } else if (this.waypoint === 'destination') {\n      marker.position = lastLeg.end_location;\n    } else {\n      this.logger.error(`Unsupported waypoint \"${\n          this.waypoint}\". Waypoint must be \"origin\" or \"destination\".`);\n    }\n  }\n\n  private async updateTitle() {\n    const marker = await this.innerMarkerPromise;\n    marker.title = this.title;\n  }\n\n  private async updateZIndex() {\n    const marker = await this.innerMarkerPromise;\n    marker.zIndex = this.zIndex;\n  }\n\n  private async onSlotChange(e: Event) {\n    const slot = e.target as HTMLSlotElement;\n    const assignedElement = slot.assignedElements()[0];\n    if (assignedElement) {\n      const marker = await this.innerMarkerPromise;\n      marker.content = assignedElement;\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'gmpx-route-marker': RouteMarker;\n  }\n}\n"]}