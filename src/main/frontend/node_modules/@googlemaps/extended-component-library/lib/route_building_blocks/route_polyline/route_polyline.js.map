{"version":3,"file":"route_polyline.js","sourceRoot":"","sources":["../../../src/route_building_blocks/route_polyline/route_polyline.ts"],"names":[],"mappings":"AAAA;;;;GAIG;;AAGH,OAAO,EAAC,aAAa,EAAE,QAAQ,EAAC,MAAM,mBAAmB,CAAC;AAE1D,OAAO,EAAC,SAAS,EAAC,MAAM,gCAAgC,CAAC;AACzD,OAAO,EAAC,QAAQ,EAAC,MAAM,yBAAyB,CAAC;AACjD,OAAO,EAAC,aAAa,EAAC,MAAM,sBAAsB,CAAC;AACnD,OAAO,EAAC,iBAAiB,EAAC,MAAM,2BAA2B,CAAC;AAG5D,MAAM,sBAAsB,GAAG;IAC7B,aAAa;IACb,cAAc;IACd,eAAe;IACf,QAAQ;IACR,WAAW;CACH,CAAC;AAEX;;GAEG;AAEI,IAAM,aAAa,GAAnB,MAAM,aAAc,SAAQ,iBAAiB;IAyClD;;;OAGG;IACH,IAAI,aAAa;QACf,OAAO,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC;IAC1C,CAAC;IAED;;;;OAIG;IACH,IAAI,oBAAoB;QACtB,OAAO,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC;IAC5C,CAAC;IAID;QACE,KAAK,EAAE,CAAC;QA5DV;;;WAGG;QAEH,kBAAa,GAAG,KAAK,CAAC;QAEtB;;WAEG;QAEH,cAAS,GAAG,KAAK,CAAC;QA2BD,0BAAqB,GAAG,IAAI,QAAQ,EAAwB,CAAC;QAmB7D,kBAAa,GAAG,IAAI,aAAa,CAAC,IAAI,CAAC,CAAC;QAIvD,IAAI,CAAC,YAAY,EAAE,CAAC;IACtB,CAAC;IAEO,KAAK,CAAC,YAAY;QACxB,MAAM,EAAC,QAAQ,EAAC,GACZ,MAAM,SAAS,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAuB,CAAC;QACtE,MAAM,QAAQ,GAAG,IAAI,QAAQ,EAAE,CAAC;QAChC,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAC/C,CAAC;IAEQ,KAAK,CAAC,iBAAiB;QAC9B,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC1B,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,oBAAoB,CAAC;QACjD,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC;QAChD,kEAAkE;QAClE,IAAI,IAAI,CAAC,WAAW,EAAE;YACpB,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACrB,MAAM,IAAI,CAAC,aAAa,CAAC,eAAgB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;SAC1D;IACH,CAAC;IAEQ,oBAAoB;QAC3B,KAAK,CAAC,oBAAoB,EAAE,CAAC;QAC7B,IAAI,CAAC,aAAa,CAAC,eAAe,EAAE,UAAU,CAAC,IAAI,CAAC,CAAC;QACrD,IAAI,CAAC,aAAa,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;IACnC,CAAC;IAEkB,OAAO,CAAC,iBAAuC;QAChE,IAAI,sBAAsB,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,iBAAiB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE;YACtE,IAAI,CAAC,uBAAuB,EAAE,CAAC;SAChC;QACD,IAAI,iBAAiB,CAAC,GAAG,CAAC,OAAO,CAAC;YAC9B,iBAAiB,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE;YACzC,IAAI,CAAC,UAAU,EAAE,CAAC;SACnB;QACD,IAAI,iBAAiB,CAAC,GAAG,CAAC,eAAe,CAAC;YACtC,CAAC,IAAI,CAAC,aAAa;gBAClB,CAAC,iBAAiB,CAAC,GAAG,CAAC,OAAO,CAAC;oBAC9B,iBAAiB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE;YAC7C,IAAI,CAAC,aAAa,CAAC,eAAe,EAAE,cAAc,EAAE,CAAC;SACtD;IACH,CAAC;IAED;;;;OAIG;IACH,SAAS;QACP,IAAI,CAAC,IAAI,CAAC,aAAa;YAAE,OAAO,IAAI,CAAC;QACrC,OAAO,IAAI,CAAC,QAAQ,EAAE,EAAE,MAAM,IAAI,IAAI,CAAC;IACzC,CAAC;IAEO,KAAK,CAAC,uBAAuB;QACnC,MAAM,OAAO,GAAG;YACd,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,YAAY,EAAE,IAAI,CAAC,YAAY;YAC/B,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,aAAa,EAAE,IAAI,CAAC,aAAa;YACjC,OAAO,EAAE,CAAC,IAAI,CAAC,SAAS;SACzB,CAAC;QACF,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,oBAAoB,CAAC;QACjD,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;IAC/B,CAAC;IAEO,KAAK,CAAC,UAAU;QACtB,IAAI,IAAI,GAAyB,EAAE,CAAC;QACpC,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9B,IAAI,KAAK,EAAE;YACT,KAAK,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,EAAE;gBAC5B,KAAK,MAAM,IAAI,IAAI,GAAG,CAAC,KAAK,EAAE;oBAC5B,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;iBAC/B;aACF;SACF;QACD,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,oBAAoB,CAAC;QACjD,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IACzB,CAAC;CACF,CAAA;AAtIC;IADC,QAAQ,CAAC,EAAC,SAAS,EAAE,iBAAiB,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC;;oDACjD;AAMtB;IADC,QAAQ,CAAC,EAAC,SAAS,EAAE,WAAW,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC;;gDAC/C;AAOlB;IADC,QAAQ,CAAC,EAAC,SAAS,EAAE,cAAc,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC;;kDAC9C;AAMrB;IADC,QAAQ,CAAC,EAAC,SAAS,EAAE,gBAAgB,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC;;oDAC9C;AAMvB;IADC,QAAQ,CAAC,EAAC,SAAS,EAAE,eAAe,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC;;mDAC9C;AAMtB;IADC,QAAQ,CAAC,EAAC,SAAS,EAAE,SAAS,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC;;6CAC9C;AArCL,aAAa;IADzB,aAAa,CAAC,qBAAqB,CAAC;;GACxB,aAAa,CA4IzB","sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {PropertyValues} from 'lit';\nimport {customElement, property} from 'lit/decorators.js';\n\nimport {APILoader} from '../../api_loader/api_loader.js';\nimport {Deferred} from '../../utils/deferred.js';\nimport {MapController} from '../map_controller.js';\nimport {RouteDataConsumer} from '../route_data_consumer.js';\nimport {LatLngBounded} from '../viewport_manager.js';\n\nconst POLYLINE_OPTIONS_PROPS = [\n  'strokeColor',\n  'strokeWeight',\n  'strokeOpacity',\n  'zIndex',\n  'invisible',\n] as const;\n\n/**\n * Renders a polyline indicating the path of a route.\n */\n@customElement('gmpx-route-polyline')\nexport class RoutePolyline extends RouteDataConsumer implements LatLngBounded {\n  /**\n   * Whether or not to automatically adjust the map's viewport to include the\n   * polyline.\n   */\n  @property({attribute: 'fit-in-viewport', type: Boolean, reflect: true})\n  fitInViewport = false;\n\n  /**\n   * Whether or not the polyline is invisible or visible on the map.\n   */\n  @property({attribute: 'invisible', type: Boolean, reflect: true})\n  invisible = false;\n\n  /**\n   * Stroke color of the polyline. All CSS3 colors are supported except for\n   * extended named colors.\n   */\n  @property({attribute: 'stroke-color', type: String, reflect: true})\n  strokeColor?: string;\n\n  /**\n   * The stroke opacity of the polyline between 0.0 and 1.0.\n   */\n  @property({attribute: 'stroke-opacity', type: Number, reflect: true})\n  strokeOpacity?: number;\n\n  /**\n   * The stroke width of the polyline in pixels.\n   */\n  @property({attribute: 'stroke-weight', type: Number, reflect: true})\n  strokeWeight?: number;\n\n  /**\n   * The z-index of the polyline compared to other polys.\n   */\n  @property({attribute: 'z-index', type: Number, reflect: true})\n  zIndex?: number;\n\n  private readonly innerPolylineDeferred = new Deferred<google.maps.Polyline>();\n\n  /**\n   * The inner `google.maps.Polyline` from the Maps JS API. This value is set\n   * once `innerPolylinePromise` is resolved.\n   */\n  get innerPolyline(): google.maps.Polyline|undefined {\n    return this.innerPolylineDeferred.value;\n  }\n\n  /**\n   * Resolves to the inner polyline when it's ready. It might not be ready\n   * immediately because the `Polyline` class is loaded asynchronously from\n   * the Maps JS API.\n   */\n  get innerPolylinePromise(): Promise<google.maps.Polyline> {\n    return this.innerPolylineDeferred.promise;\n  }\n\n  private readonly mapController = new MapController(this);\n\n  constructor() {\n    super();\n    this.initPolyline();\n  }\n\n  private async initPolyline() {\n    const {Polyline} =\n        await APILoader.importLibrary('maps', this) as typeof google.maps;\n    const polyline = new Polyline();\n    this.innerPolylineDeferred.resolve(polyline);\n  }\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    const polyline = await this.innerPolylinePromise;\n    const map = await this.mapController.mapPromise;\n    // Make sure the component hasn't been disconnected while awaiting\n    if (this.isConnected) {\n      polyline.setMap(map);\n      await this.mapController.viewportManager!.register(this);\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.mapController.viewportManager?.unregister(this);\n    this.innerPolyline?.setMap(null);\n  }\n\n  protected override updated(changedProperties: PropertyValues<this>) {\n    if (POLYLINE_OPTIONS_PROPS.some((prop) => changedProperties.has(prop))) {\n      this.setInnerPolylineOptions();\n    }\n    if (changedProperties.has('route') ||\n        changedProperties.has('contextRoute')) {\n      this.updatePath();\n    }\n    if (changedProperties.has('fitInViewport') ||\n        (this.fitInViewport &&\n         (changedProperties.has('route') ||\n          changedProperties.has('contextRoute')))) {\n      this.mapController.viewportManager?.updateViewport();\n    }\n  }\n\n  /**\n   * Returns the `LatLngBounds` of the polyline that should be included in the\n   * map's viewport, for use by the `ViewportManager`.\n   * @ignore\n   */\n  getBounds(): google.maps.LatLngBounds|null {\n    if (!this.fitInViewport) return null;\n    return this.getRoute()?.bounds ?? null;\n  }\n\n  private async setInnerPolylineOptions() {\n    const options = {\n      strokeColor: this.strokeColor,\n      strokeWeight: this.strokeWeight,\n      zIndex: this.zIndex,\n      strokeOpacity: this.strokeOpacity,\n      visible: !this.invisible,\n    };\n    const polyline = await this.innerPolylinePromise;\n    polyline.setOptions(options);\n  }\n\n  private async updatePath() {\n    let path: google.maps.LatLng[] = [];\n    const route = this.getRoute();\n    if (route) {\n      for (const leg of route.legs) {\n        for (const step of leg.steps) {\n          path = path.concat(step.path);\n        }\n      }\n    }\n    const polyline = await this.innerPolylinePromise;\n    polyline.setPath(path);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'gmpx-route-polyline': RoutePolyline;\n  }\n}\n"]}