{"version":3,"file":"route_data_provider.js","sourceRoot":"","sources":["../../../src/route_building_blocks/route_data_provider/route_data_provider.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {provide} from '@lit/context';\nimport {customElement, property} from 'lit/decorators.js';\n\nimport {BaseComponent} from '../../base/base_component.js';\nimport {DirectionsController} from '../../place_building_blocks/place_distance_label/directions_controller.js';\nimport {LAT_LNG_LITERAL_ATTRIBUTE_CONVERTER} from '../../utils/attribute_converters.js';\nimport {routeContext} from '../route_data_consumer.js';\n\ntype DirectionsRoute = google.maps.DirectionsRoute;\ntype LatLng = google.maps.LatLng;\ntype LatLngLiteral = google.maps.LatLngLiteral;\n\n/**\n * Provides route data to child components as context.\n *\n * This component can fetch route data from the Directions API, or forward a\n * `DirectionsRoute` object provided from elsewhere in code. The component will\n * locally cache route data to avoid redundant API requests.\n *\n * @slot - Elements to receive route data.\n *\n * @event {RequestErrorEvent} gmpx-requesterror - Indicates an error condition\n * in an underlying Google Maps JavaScript API call. (React: onRequestError)\n */\n@customElement('gmpx-route-data-provider')\nexport class RouteDataProvider extends BaseComponent {\n  /**\n   * @ignore\n   * Route data passed to child `RouteDataConsumer`s via context.\n   */\n  @provide({context: routeContext})\n  @property({\n    attribute: false,\n    // The contextRoute property is only set by the component itself during its\n    // update cycle. Don't trigger a second update when this happens.\n    hasChanged: () => false,\n  })\n  contextRoute: DirectionsRoute|undefined;\n\n  /**\n   * The destination of the directions request as a lat/lng. When setting the\n   * destination, only one of lat/lng, Place ID, or address should be specified.\n   */\n  @property({\n    converter: LAT_LNG_LITERAL_ATTRIBUTE_CONVERTER,\n    attribute: 'destination-lat-lng',\n    reflect: true\n  })\n  destinationLatLng?: LatLng|LatLngLiteral;\n\n  /**\n   * The destination of the directions request as a Place ID. When setting the\n   * destination, only one of lat/lng, Place ID, or address should be specified.\n   */\n  @property({type: String, attribute: 'destination-place-id', reflect: true})\n  destinationPlaceId?: string;\n\n  /**\n   * The destination of the directions request as an address query. When setting\n   * the destination, only one of lat/lng, Place ID, or address should be\n   * specified.\n   */\n  @property({type: String, attribute: 'destination-address', reflect: true})\n  destinationAddress?: string;\n\n  /**\n   * The origin of the directions request as a lat/lng. When setting the origin,\n   * only one of lat/lng, Place ID, or address should be specified.\n   */\n  @property({\n    converter: LAT_LNG_LITERAL_ATTRIBUTE_CONVERTER,\n    attribute: 'origin-lat-lng',\n    reflect: true\n  })\n  originLatLng?: LatLng|LatLngLiteral;\n\n  /**\n   * The origin of the directions request as a Place ID. When setting the\n   * origin, only one of lat/lng, Place ID, or address should be specified.\n   */\n  @property({type: String, attribute: 'origin-place-id', reflect: true})\n  originPlaceId?: string;\n\n  /**\n   * The origin of the directions request as an address query. When setting the\n   * origin, only one of lat/lng, Place ID, or address should be specified.\n   */\n  @property({type: String, attribute: 'origin-address', reflect: true})\n  originAddress?: string;\n\n  /**\n   * Route data to be provided to consumers directly, instead of making an API\n   * call.\n   */\n  @property({attribute: false}) route?: DirectionsRoute;\n\n  /**\n   * The travel mode of the directions request.\n   */\n  @property({type: String, attribute: 'travel-mode', reflect: true})\n  travelMode: Lowercase<google.maps.TravelMode> = 'driving';\n\n  private readonly directionsController = new DirectionsController(this);\n\n  protected override updated() {\n    this.updateContextRoute();\n  }\n\n  private async updateContextRoute() {\n    if (this.route) {\n      this.contextRoute = this.route;\n      return;\n    }\n\n    const numOrigins =\n        numTruthy(this.originAddress, this.originPlaceId, this.originLatLng);\n    const numDestinations = numTruthy(\n        this.destinationAddress, this.destinationPlaceId,\n        this.destinationLatLng);\n\n    if (numOrigins === 1 && numDestinations === 1) {\n      this.contextRoute = await this.fetchRoute();\n    } else {\n      if (numOrigins > 1 && numDestinations !== 0) {\n        this.logger.error(\n            'Too many origins. Only one of origin-lat-lng, ' +\n            'origin-place-id, or origin-address may be specified.');\n      }\n      if (numDestinations > 1 && numOrigins !== 0) {\n        this.logger.error(\n            'Too many destinations. Only one of destination-lat-lng, ' +\n            'destination-place-id, or destination-address may be specified.');\n      }\n      this.contextRoute = undefined;\n    }\n  }\n\n  private async fetchRoute(): Promise<DirectionsRoute|undefined> {\n    // If the request fails, directionsController.route will dispatch a\n    // RequestErrorEvent and return null.\n    const result = await this.directionsController.route({\n      origin: this.getOriginRequestObject(),\n      destination: this.getDestinationRequestObject(),\n      travelMode: this.travelMode?.toUpperCase() as google.maps.TravelMode,\n    });\n    return result?.routes ? result.routes[0] : undefined;\n  }\n\n  private getOriginRequestObject(): google.maps.Place {\n    if (this.originLatLng) {\n      return {location: this.originLatLng};\n    } else if (this.originPlaceId) {\n      return {placeId: this.originPlaceId};\n    } else {\n      return {query: this.originAddress};\n    }\n  }\n\n  private getDestinationRequestObject(): google.maps.Place {\n    if (this.destinationLatLng) {\n      return {location: this.destinationLatLng};\n    } else if (this.destinationPlaceId) {\n      return {placeId: this.destinationPlaceId};\n    } else {\n      return {query: this.destinationAddress};\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'gmpx-route-data-provider': RouteDataProvider;\n  }\n}\n\n/**\n * Counts and returns the number of arguments that are truthy.\n */\nfunction numTruthy(...args: unknown[]): number {\n  return args.filter((x) => x).length;\n}\n"]}