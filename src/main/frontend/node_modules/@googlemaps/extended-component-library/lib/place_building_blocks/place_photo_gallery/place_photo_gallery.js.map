{"version":3,"file":"place_photo_gallery.js","sourceRoot":"","sources":["../../../src/place_building_blocks/place_photo_gallery/place_photo_gallery.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {css, html} from 'lit';\nimport {customElement, property, query, state} from 'lit/decorators.js';\nimport {ifDefined} from 'lit/directives/if-defined.js';\nimport {map} from 'lit/directives/map.js';\nimport {styleMap} from 'lit/directives/style-map.js';\nimport {when} from 'lit/directives/when.js';\n\nimport {GMPX_FONT_CAPTION, GMPX_FONT_SIZE_BASE, GMPX_FONT_TITLE_MEDIUM} from '../../base/common_styles.js';\nimport {FocusController} from '../../base/focus_controller.js';\nimport {LocalizationController} from '../../base/localization_controller.js';\nimport {WebFont, WebFontController} from '../../base/web_font_controller.js';\nimport type {AuthorAttribution, Photo, Place} from '../../utils/googlemaps_types.js';\nimport {renderAttribution} from '../../utils/place_utils.js';\nimport {PlaceDataConsumer} from '../place_data_consumer.js';\n\n/**\n * Maximum width/height of a Place Photo that can be requested, in pixels; see:\n * https://developers.google.com/maps/documentation/places/web-service/place-photos#maxheightpx-and-maxwidthpx.\n */\nconst MAX_PHOTO_SIZE_PX = 4800;\n\n/** Maximum width/height of a Place Photo to display as tile, in pixels. */\nconst MAX_TILE_PHOTO_SIZE_PX = 1200;\n\n/** Spacing for margins and paddings based on baseline font size. */\nconst SPACING_BASE = css`calc(${GMPX_FONT_SIZE_BASE} * 0.5)`;\n\ninterface FormattedPhoto {\n  uri: string;\n  tileUri: string;\n  attributions: AuthorAttribution[];\n}\n\ninterface TileSize {\n  widthPx: number;\n  heightPx: number;\n}\n\n/**\n * Returns the desired photo size in pixels based on CSS pixels and max size,\n * accounting for diff between physical and CSS pixels on current device; see:\n * https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio.\n */\nfunction getPhotoSize(cssPx: number, max: number) {\n  const devicePx = Math.ceil(cssPx * window.devicePixelRatio);\n  return Math.min(devicePx, max);\n}\n\n/**\n * Formats a `google.maps.places.Photo` object for display based on tile size.\n *\n * If photo is wider relative to its height compared to the tile, then its\n * height should be capped at the tile's height; vice versa for tile width.\n *\n *                                            ┌┄┄┄┄┄┄┄┄┄┄┄┄┐\n *                                            ┆            ┆  PHOTO\n *    ┌┄┄┄┄┄┌────────────┐┄┄┄┄┄┐              ├────────────┤\n *    ┆     │            │     ┆              │            │\n *    ┆     │    TILE    │     ┆  PHOTO       │    TILE    │\n *    ┆     │            │     ┆              │            │\n *    └┄┄┄┄┄└────────────┘┄┄┄┄┄┘              ├────────────┤\n *                                            ┆            ┆\n *                                            └┄┄┄┄┄┄┄┄┄┄┄┄┘\n */\nfunction formatPhoto(photo: Photo, tileSize: TileSize): FormattedPhoto {\n  const photoSizeRatio = photo.widthPx / photo.heightPx;\n  const windowSizeRatio = window.innerWidth / window.innerHeight;\n  const tileSizeRatio = tileSize.widthPx / tileSize.heightPx;\n\n  const lightboxPhotoOptions = photoSizeRatio > windowSizeRatio ?\n      {maxHeight: getPhotoSize(window.innerHeight, MAX_PHOTO_SIZE_PX)} :\n      {maxWidth: getPhotoSize(window.innerWidth, MAX_PHOTO_SIZE_PX)};\n  const tilePhotoOptions = photoSizeRatio > tileSizeRatio ?\n      {maxHeight: getPhotoSize(tileSize.heightPx, MAX_TILE_PHOTO_SIZE_PX)} :\n      {maxWidth: getPhotoSize(tileSize.widthPx, MAX_TILE_PHOTO_SIZE_PX)};\n\n  return {\n    uri: photo.getURI(lightboxPhotoOptions),\n    tileUri: photo.getURI(tilePhotoOptions),\n    attributions: photo.authorAttributions,\n  };\n}\n\nfunction stopEscapePropagation(event: KeyboardEvent) {\n  if (event.key === 'Escape') event.stopPropagation();\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'gmpx-place-photo-gallery': PlacePhotoGallery;\n  }\n}\n\n/**\n * Component that displays photos of this place as tiles, with a lightbox view\n * when a photo is clicked. The lightbox includes proper photo attribution.\n *\n * @csspart tile - Styles each individual photo tile, including border radius,\n * width/height, margin, background color before image is loaded, etc.\n * \n * @cssproperty [--gmpx-font-family-base] - Font family used for captions in the lightbox.\n * @cssproperty [--gmpx-font-family-headings] - Font family of the place title in the lightbox.\n * @cssproperty [--gmpx-font-size-base] - Used to scale the component.\n */\n@customElement('gmpx-place-photo-gallery')\nexport class PlacePhotoGallery extends PlaceDataConsumer {\n  static override styles = css`\n    :host(:not([hidden])) {\n      display: block;\n    }\n\n    .container.hide-focus-ring button:focus {\n      outline: none;\n    }\n\n    a {\n      color: inherit;\n    }\n\n    button {\n      background: none;\n      border: none;\n      color: inherit;\n      cursor: pointer;\n      padding: 0;\n    }\n\n    button[disabled] {\n      cursor: default;\n    }\n\n    [part=\"tile\"] {\n      background-color: #f5f5f5;\n      background-position: center;\n      background-size: cover;\n      border-radius: 8px;\n      display: inline-block;\n      height: 134px;\n      width: 142px;\n    }\n\n    /* The dialog element has a default border-width: initial (3px),\n       padding: 1em, and max-height/width: calc((100% - 6px) - 2em). We remove\n       the border and take the corresponding 6px out of the height/width\n       calculation so it still fills the screen. */\n    .lightbox {\n      border-width: 0;\n      color: white;\n      height: 100%;\n      max-height: calc(100% - 2em);\n      max-width: calc(100% - 2em);\n      width: 100%;\n    }\n\n    .backdrop {\n      background: black;\n      inset: 0;\n      position: absolute;\n    }\n\n    .photo {\n      inset: 0;\n      margin: auto;\n      max-height: 100%;\n      max-width: 100%;\n      position: absolute;\n    }\n\n    .icon {\n      font-size: calc(${GMPX_FONT_SIZE_BASE} * 2);\n      vertical-align: middle;\n    }\n\n    .info-card {\n      background: rgba(32, 33, 36, 0.7);\n      border-radius: 8px;\n      display: flex;\n      padding: ${GMPX_FONT_SIZE_BASE};\n      position: absolute;\n    }\n\n    .info-card .text-container {\n      flex-direction: column;\n      padding: 0 ${SPACING_BASE};\n    }\n\n    .info-card .title {\n      font: ${GMPX_FONT_TITLE_MEDIUM};\n    }\n\n    .info-card .caption {\n      font : ${GMPX_FONT_CAPTION};\n    }\n\n    .nav-controls {\n      bottom: ${GMPX_FONT_SIZE_BASE};\n      left: 0;\n      margin: 0 auto;\n      position: absolute;\n      right: 0;\n      width: fit-content;\n    }\n\n    .nav-controls button {\n      background-color: rgba(32, 33, 36, 0.7);\n      border-radius: calc(${GMPX_FONT_SIZE_BASE} * 2);\n      padding: ${SPACING_BASE};\n      margin: ${SPACING_BASE};\n    }\n\n    .nav-controls button[disabled] {\n      opacity: 0.5;\n    }\n  `;\n\n  /**\n   * The maximum number of photos to display as tiles. If undefined, all\n   * available photos from the Place object will be displayed.\n   *\n   * Note that the Places API can fetch up to ten photos of a place.\n   */\n  @property({attribute: 'max-tiles', reflect: true, type: Number})\n  maxTiles?: number;\n\n  @state() private selectedIndex = 0;\n  @state() private tileSize?: TileSize;\n\n  @query('.container') private readonly containerElement?: HTMLDivElement;\n  @query('.lightbox') private readonly lightboxElement?: HTMLDialogElement;\n  @query('[part=\"tile\"]') private readonly firstTileElement?: HTMLButtonElement;\n\n  protected readonly focusController =\n      new FocusController(this, (isKeyboardNavigating) => {\n        if (isKeyboardNavigating) {\n          this.containerElement?.classList.remove('hide-focus-ring');\n        } else {\n          this.containerElement?.classList.add('hide-focus-ring');\n        }\n      });\n\n  protected readonly fontLoader = new WebFontController(\n      this, [WebFont.GOOGLE_SANS_TEXT, WebFont.MATERIAL_SYMBOLS_OUTLINED]);\n\n  private readonly keydownEventListener = ({key}: KeyboardEvent) => {\n    if (!this.lightboxElement?.open) return;\n    switch (key) {\n      case 'ArrowLeft':\n        this.isRTL() ? this.navigateToNext() : this.navigateToPrevious();\n        break;\n      case 'ArrowRight':\n        this.isRTL() ? this.navigateToPrevious() : this.navigateToNext();\n        break;\n      default:\n    }\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    document.addEventListener('keydown', this.keydownEventListener);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    document.removeEventListener('keydown', this.keydownEventListener);\n  }\n\n  protected readonly getMsg = LocalizationController.buildLocalizer(this);\n\n  protected override render() {\n    const photos = this.getFormattedPhotos();\n    const selectedPhoto = photos[this.selectedIndex];\n    const placeName = this.getPlace()?.displayName;\n\n    // clang-format off\n    const captionCard = html`\n      <div class=\"info-card\">\n        <button\n          aria-label=${this.getMsg('PLACE_PHOTO_BACK_ARIA_LABEL')}\n          autofocus\n          @click=${this.closeLightbox}\n        >\n          <span aria-hidden=\"true\" class=\"icon material-symbols-outlined\">\n            ${this.isRTL() ? 'arrow_forward' : 'arrow_back'}\n          </span>\n        </button>\n        <div class=\"text-container\">\n          ${when(placeName, () => html`<div class=\"title\">${placeName}</div>`)}\n          ${when(selectedPhoto?.attributions.length, () => html`\n            <div class=\"caption\">\n              <span>${this.getMsg('PLACE_PHOTO_ATTRIBUTION_PREFIX')}</span>\n              ${map(selectedPhoto!.attributions,\n                    ({displayName, uri}) =>\n                        html`${renderAttribution(displayName, uri ?? null)} `)}\n            </div>\n          `)}\n        </div>\n      </div>\n    `;\n    // clang-format on\n\n    const navControls = html`\n      <div class=\"nav-controls\">\n        <button\n          aria-label=${this.getMsg('PLACE_PHOTO_PREV_ARIA_LABEL')}\n          @click=${this.navigateToPrevious}\n          .disabled=${this.selectedIndex === 0}\n        >\n          <span aria-hidden=\"true\" class=\"icon material-symbols-outlined\">\n            ${this.isRTL() ? 'chevron_right' : 'chevron_left'}\n          </span>\n        </button>\n        <button\n          aria-label=${this.getMsg('PLACE_PHOTO_NEXT_ARIA_LABEL')}\n          @click=${this.navigateToNext}\n          .disabled=${this.selectedIndex === photos.length - 1}\n        >\n          <span aria-hidden=\"true\" class=\"icon material-symbols-outlined\">\n            ${this.isRTL() ? 'chevron_left' : 'chevron_right'}\n          </span>\n        </button>\n      </div>\n    `;\n\n    // clang-format off\n    const renderTileButton = (photo: FormattedPhoto|null, i: number) => html`\n      <button\n        aria-label=${this.getMsg('PLACE_PHOTO_TILE_ARIA_LABEL', i + 1)}\n        @click=${() => void this.openLightbox(i)}\n        .disabled=${!photo}\n        part=\"tile\"\n        style=${styleMap({\n          'background-image': photo && `url(${photo.tileUri})`,\n        })}\n      ></button>\n    `;\n    // clang-format on\n\n    // Note on the <dialog>'s keydown listener: Prevent escape keydowns from\n    // propagating beyond the lightbox so that they don't cause things like\n    // closing an overlay layout. The <dialog> will close automatically on\n    // escape, so we don't have to worry about catching the event ourselves.\n    return html`\n      <div class=\"container\">\n        <div>${map(photos.slice(0, this.maxTiles), renderTileButton)}</div>\n        <dialog class=\"lightbox\" @keydown=${stopEscapePropagation}>\n          <div class=\"backdrop\" @click=${this.closeLightbox}></div>\n          <img\n            alt=${this.getMsg('PLACE_PHOTO_ALT', placeName ?? '')}\n            class=\"photo\"\n            src=${ifDefined(selectedPhoto?.uri)}\n          />\n          ${captionCard}\n          ${navControls}\n        </dialog>\n      </div>\n    `;\n  }\n\n  protected override updated() {\n    if (!this.tileSize && this.firstTileElement) {\n      // Note that sometimes a tile's BoundingClientRect becomes defined outside\n      // Lit's reactive update cycle. In such cases the tile size will be zero,\n      // and we cap width/height at `MAX_TILE_PHOTO_SIZE_PX` to avoid requesting\n      // an overly large image.\n      this.tileSize = {\n        widthPx: this.firstTileElement.clientWidth || MAX_TILE_PHOTO_SIZE_PX,\n        heightPx: this.firstTileElement.clientHeight || MAX_TILE_PHOTO_SIZE_PX,\n      };\n    }\n  }\n\n  /** @ignore */\n  getRequiredFields(): Array<keyof Place> {\n    return ['displayName', 'photos'];\n  }\n\n  protected override placeHasData(place: Place): boolean {\n    return !!(place.photos && place.photos.length > 0);\n  }\n\n  private getFormattedPhotos(): Array<FormattedPhoto|null> {\n    const place = this.getPlace();\n    // If Place data is not yet available or the tile elements have not been\n    // rendered, then return a list of null values as placeholders.\n    if (place === undefined || !this.tileSize) {\n      return new Array(10).fill(null);\n    }\n    if (!place?.photos) return [];\n    return place.photos.map((photo) => formatPhoto(photo, this.tileSize!));\n  }\n\n  private isRTL(): boolean {\n    return getComputedStyle(this).direction.toLowerCase() === 'rtl';\n  }\n\n  private async openLightbox(index: number) {\n    this.selectedIndex = index;\n    await this.updateComplete;\n    this.lightboxElement?.showModal();\n  }\n\n  private closeLightbox() {\n    this.lightboxElement?.close();\n  }\n\n  private navigateToPrevious() {\n    if (this.selectedIndex > 0) this.selectedIndex--;\n  }\n\n  private navigateToNext() {\n    const numPhotos = this.getPlace()?.photos?.length;\n    if (numPhotos && this.selectedIndex < numPhotos - 1) this.selectedIndex++;\n  }\n}\n"]}