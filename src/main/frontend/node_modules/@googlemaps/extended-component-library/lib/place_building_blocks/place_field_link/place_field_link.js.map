{"version":3,"file":"place_field_link.js","sourceRoot":"","sources":["../../../src/place_building_blocks/place_field_link/place_field_link.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {css, html, nothing} from 'lit';\nimport {customElement, property} from 'lit/decorators.js';\nimport {when} from 'lit/directives/when.js';\n\nimport type {Place} from '../../utils/googlemaps_types.js';\nimport {PlaceDataConsumer} from '../place_data_consumer.js';\n\n\n/**\n * Supported field names for `PlaceFieldLink`, formatted as `Place` fields.\n */\nexport const PLACE_LINK_FIELDS = [\n  'googleMapsURI',\n  'websiteURI',\n] as const;\n\n/**\n * Supported field names for `PlaceFieldLink`, formatted as `PlaceResult`\n * fields.\n */\nexport const PLACE_RESULT_LINK_FIELDS = [\n  'url',\n  'website',\n] as const;\n\ntype PlaceLinkField = typeof PLACE_LINK_FIELDS[number];\ntype PlaceResultLinkField = typeof PLACE_RESULT_LINK_FIELDS[number];\n/**\n * String union type of all supported field names for `PlaceFieldLink`.\n */\nexport type LinkField = PlaceLinkField|PlaceResultLinkField;\n\nfunction toPlaceLinkField(field: LinkField): PlaceLinkField {\n  switch (field) {\n    case 'url':\n      return 'googleMapsURI';\n    case 'website':\n      return 'websiteURI';\n    default:\n      return field;\n  }\n}\n\nfunction getFieldValue(place: Place, field: LinkField): string|null|undefined {\n  switch (toPlaceLinkField(field)) {\n    case 'googleMapsURI':\n      return place.googleMapsURI;\n    case 'websiteURI':\n      return place.websiteURI;\n    default:\n      return undefined;\n  }\n}\n\nfunction getUrlDomain(url: string): string {\n  const match = url.match(/^(https?:\\/\\/)?(www\\.)?([^\\/\\?]+)/);\n  return (match && match.length > 3) ? match[3] : url;\n}\n\n/**\n * Component that renders an anchor tag to one of this place's URLs:\n * `websiteURI` or `googleMapsURI`. By default, renders a link to `websiteURI`\n * with the URL's domain as the text.\n */\n@customElement('gmpx-place-field-link')\nexport class PlaceFieldLink extends PlaceDataConsumer {\n  static override styles = css`\n    :host(:hover) {\n      text-decoration: underline;\n    }\n\n    a {\n      color: inherit;\n      text-decoration: inherit;\n    }\n  `;\n\n  /**\n   * The field to link to, formatted as it is on either a `Place` or\n   * `PlaceResult`.\n   *\n   * Allowed fields are: `googleMapsURI` or `url` for a link to this place on\n   * Google Maps; `websiteURI` or `website` for a link to this place's\n   * website.\n   */\n  @property({type: String, reflect: true, attribute: 'href-field'})\n  hrefField: LinkField = 'websiteURI';\n\n  /**\n   * The link description that gets read by assistive technology.\n   *\n   * Set this to something more descriptive if the link's purpose isn't clear\n   * from its text content alone. For example, if the link text is just\n   * \"Website\", then the `aria-label` could be \"Website for (business name)\".\n   */\n  @property({attribute: 'aria-label', reflect: true, type: String})\n  override ariaLabel: string|null = null;\n\n  protected override render() {\n    const href = this.getHref();\n    // clang-format off\n    return html`${when(href, () => html`\n      <a target=\"_blank\" rel=\"noopener noreferrer\" href=${href!}\n          aria-label=${this.ariaLabel ?? nothing}>\n        ${when(this.hasContentForSlot(),\n          () => html`<slot></slot>`,\n          () => html`${this.getDefaultLinkText(href!)}`,\n        )}\n      </a>\n    `,)}`;\n    // clang-format on\n  }\n\n  protected override updated() {\n    // If the aria-label attribute is set, hide it from the a11y tree. Otherwise\n    // the component and its shadow DOM content show up as duplicate nodes with\n    // the same aria-label.\n    this.role = this.ariaLabel != null ? 'none' : null;\n  }\n\n  /** @ignore */\n  getRequiredFields(): Array<keyof Place> {\n    return [toPlaceLinkField(this.hrefField)];\n  }\n\n  protected override placeHasData(place: Place): boolean {\n    return (getFieldValue(place, this.hrefField) != null);\n  }\n\n  private getHref(): string|null {\n    const place = this.getPlace();\n    if (!place) return null;\n    return getFieldValue(place, this.hrefField) ?? null;\n  }\n\n  private hasContentForSlot(): boolean {\n    return !!(this.textContent?.trim() || (this.children.length > 0));\n  }\n\n  private getDefaultLinkText(href: string): string {\n    switch (toPlaceLinkField(this.hrefField)) {\n      case 'googleMapsURI':\n        return 'View on Google Maps';\n      case 'websiteURI':\n      default:\n        return getUrlDomain(href);\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'gmpx-place-field-link': PlaceFieldLink;\n  }\n}\n"]}