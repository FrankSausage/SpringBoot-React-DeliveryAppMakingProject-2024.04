{"version":3,"file":"place_field_boolean.js","sourceRoot":"","sources":["../../../src/place_building_blocks/place_field_boolean/place_field_boolean.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {html, PropertyValues} from 'lit';\nimport {customElement, property, state} from 'lit/decorators.js';\nimport {choose} from 'lit/directives/choose.js';\n\nimport {Deferred} from '../../utils/deferred.js';\nimport type {Place} from '../../utils/googlemaps_types.js';\nimport {hasDataForOpeningCalculations} from '../../utils/place_utils.js';\nimport {Poll} from '../../utils/poll.js';\nimport {PlaceDataConsumer} from '../place_data_consumer.js';\n\nconst PLACE_BOOLEAN_FIELDS_SYNC_ACCESS = [\n  'hasCurbsidePickup',\n  'hasDelivery',\n  'hasDineIn',\n  'hasTakeout',\n  'hasWheelchairAccessibleEntrance',\n  'isReservable',\n  'servesBeer',\n  'servesBreakfast',\n  'servesBrunch',\n  'servesDinner',\n  'servesLunch',\n  'servesVegetarianFood',\n  'servesWine',\n] as const;\n\nconst PLACE_BOOLEAN_FIELDS_ASYNC_ACCESS = [\n  'isOpen()',\n] as const;\n\n/**\n * Supported field names for `PlaceFieldBoolean`, formatted as `Place` fields.\n */\nexport const PLACE_BOOLEAN_FIELDS = [\n  ...PLACE_BOOLEAN_FIELDS_SYNC_ACCESS,\n  ...PLACE_BOOLEAN_FIELDS_ASYNC_ACCESS,\n] as const;\n\n/**\n * Supported field names for `PlaceFieldBoolean`, formatted as `PlaceResult`\n * fields.\n */\nexport const PLACE_RESULT_BOOLEAN_FIELDS = [\n  'opening_hours.isOpen()',\n] as const;\n\ntype AsyncPlaceBooleanField = typeof PLACE_BOOLEAN_FIELDS_ASYNC_ACCESS[number];\ntype SyncPlaceBooleanField = typeof PLACE_BOOLEAN_FIELDS_SYNC_ACCESS[number];\ntype PlaceBooleanField = AsyncPlaceBooleanField|SyncPlaceBooleanField;\ntype PlaceResultBooleanField = typeof PLACE_RESULT_BOOLEAN_FIELDS[number];\n\n/**\n * String union type of all supported field names for `PlaceFieldBoolean`.\n */\nexport type BooleanField = PlaceBooleanField|PlaceResultBooleanField;\n\n// Fields representing methods can request polled updates.\nconst FIELD_TO_POLLING_INTERVAL_MS: {[field: string]: number} = {\n  'isOpen()': 60 * 1000\n};\n\nfunction toPlaceBooleanField(field: BooleanField): PlaceBooleanField {\n  return (field === 'opening_hours.isOpen()') ? 'isOpen()' : field;\n}\n\nasync function isOpenWithoutFetching(place: Place): Promise<boolean|undefined> {\n  // On a `Place`, `isOpen()` will asynchronously fetch these three fields. If\n  // we don't have all three already, then we treat `isOpen` is missing data\n  // instead of making an unintended API call.\n  //\n  // When using the Place Data Provider component, these fields will be\n  // automatically fetched in advance.\n  if (place && hasDataForOpeningCalculations(place)) {\n    return await place.isOpen();\n  } else {\n    return undefined;\n  }\n}\n\n/**\n * This function retrieves a static value from a `Place` by its string name.\n * Note that it does not evaluate Place methods such as `isOpen()`.\n */\nfunction getFieldValue(place: Place, field: PlaceBooleanField): boolean|null|\n    undefined {\n  switch (field) {\n    case 'hasCurbsidePickup':\n      return place.hasCurbsidePickup;\n    case 'hasDelivery':\n      return place.hasDelivery;\n    case 'hasDineIn':\n      return place.hasDineIn;\n    case 'hasTakeout':\n      return place.hasTakeout;\n    case 'hasWheelchairAccessibleEntrance':\n      return place.accessibilityOptions?.hasWheelchairAccessibleEntrance;\n    case 'isReservable':\n      return place.isReservable;\n    case 'servesBeer':\n      return place.servesBeer;\n    case 'servesBreakfast':\n      return place.servesBreakfast;\n    case 'servesBrunch':\n      return place.servesBrunch;\n    case 'servesDinner':\n      return place.servesDinner;\n    case 'servesLunch':\n      return place.servesLunch;\n    case 'servesVegetarianFood':\n      return place.servesVegetarianFood;\n    case 'servesWine':\n      return place.servesWine;\n    default:\n      return undefined;\n  }\n}\n\nfunction isAsyncBooleanField(field: PlaceBooleanField):\n    field is AsyncPlaceBooleanField {\n  return field === 'isOpen()';\n}\n\nasync function getBooleanAsync(place: Place, field: AsyncPlaceBooleanField):\n    Promise<boolean|null|undefined> {\n  if (field === 'isOpen()') {\n    return isOpenWithoutFetching(place);\n  }\n  return null;\n}\n\nfunction getBooleanSync(place: Place, field: SyncPlaceBooleanField): boolean|\n    null|undefined {\n  return getFieldValue(place, field) ?? null;\n}\n\n/**\n * Component that conditionally renders content depending on the value of a\n * boolean field, or the `isOpen()` method which returns a boolean.\n *\n * Include a child element with `slot=\"true\"` to display content when the\n * boolean value is true. Likewise, a child element with `slot=\"false\"` will be\n * displayed when the boolean value is false.\n * \n * @slot true - Content to be displayed when the boolean value is true.\n * @slot false - Content to be displayed when the boolean value is false.\n */\n@customElement('gmpx-place-field-boolean')\nexport class PlaceFieldBoolean extends PlaceDataConsumer {\n  /**\n   * The field to display, formatted as it is on either a `Place` or\n   * `PlaceResult`.\n   *\n   * Allowed [Place\n   * fields](https://developers.google.com/maps/documentation/javascript/reference/place)\n   * are `hasCurbsidePickup`, `hasDelivery`, `hasDineIn`, `hasTakeout`,\n   * `hasWheelchairAccessibleEntrance`, `isReservable`, `servesBeer`,\n   * `servesBreakfast`, `servesBrunch`, `servesDinner`, `servesLunch`,\n   * `servesVegetarianFood`, `servesWine`, and `isOpen()`. Please note that only\n   * `isOpen()` is supported by the legacy [`PlaceResult`\n   * class](https://developers.google.com/maps/documentation/javascript/reference/places-service#PlaceResult).\n   *\n   * The component also supports the `PlaceResult` field specifier\n   * `opening_hours.isOpen()` as an alias for `isOpen()`.\n   */\n  @property({type: String, reflect: true}) field?: BooleanField;\n\n  /** Boolean value to be rendered synchronously. */\n  @state() private valueToRender?: boolean|null;\n\n  private readonly poll = new Poll();\n  private asyncRenderComplete?: Deferred;\n\n  protected override render() {\n    return html`${\n        choose(\n            this.valueToRender,\n            [\n              [true, () => html`<slot name=\"true\"></slot>`],\n              [false, () => html`<slot name=\"false\"></slot>`],\n            ],\n            () => html``)}`;\n  }\n\n  /** @ignore */\n  getRequiredFields(): Array<keyof Place> {\n    if (!this.field) return [];\n    const placeField = toPlaceBooleanField(this.field);\n    switch (placeField) {\n      case 'isOpen()':\n        return [\n          'businessStatus',\n          'regularOpeningHours',\n          'utcOffsetMinutes',\n        ];\n      case 'hasWheelchairAccessibleEntrance':\n        return ['accessibilityOptions'];\n      default:\n        return [placeField];\n    }\n  }\n\n  protected override placeHasData(place: Place): boolean {\n    if (!this.field) return false;\n    const placeField = toPlaceBooleanField(this.field);\n\n    if (placeField === 'isOpen()') {\n      return hasDataForOpeningCalculations(place);\n    }\n    return getFieldValue(place, placeField) != null;\n  }\n\n  /** @ignore */\n  protected override async getUpdateComplete() {\n    const result = await super.getUpdateComplete();\n\n    // Modify the updateComplete promise to also await an async internal\n    // state update + render.\n    if (this.asyncRenderComplete) {\n      await this.asyncRenderComplete.promise;\n    }\n    return result;\n  }\n\n  protected override willUpdate(changedProperties: PropertyValues<this>) {\n    super.willUpdate(changedProperties);\n\n    this.updateValueToRender();\n\n    // Set up polled updates for certain fields.\n    if (changedProperties.has('field')) {\n      this.poll.stop();\n      if (this.field) {\n        const pollingInterval =\n            FIELD_TO_POLLING_INTERVAL_MS[toPlaceBooleanField(this.field)];\n        if (pollingInterval) {\n          this.poll.start(() => void this.requestUpdate(), pollingInterval);\n        }\n      }\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.poll.stop();\n    this.resetAsyncRenderPromise();\n  }\n\n  /**\n   * Updates the internal state value used for rendering HTML. Depending on\n   * the Place field chosen, this method may make a synchronous update, or may\n   * trigger a task to update the value later [e.g. with isOpen()].\n   */\n  private updateValueToRender() {\n    const place = this.getPlace();\n    this.resetAsyncRenderPromise();\n    if (!place || !this.field) {\n      // No Place or field to render? Do a synchronous update.\n      this.valueToRender = undefined;\n      return;\n    }\n\n    const placeField = toPlaceBooleanField(this.field);\n    if (isAsyncBooleanField(placeField)) {\n      // Getting the value of this field is an async operation. Kick off a task\n      // to fetch it.\n      this.asyncRenderComplete = new Deferred();\n      getBooleanAsync(place, placeField).then(val => {\n        this.valueToRender = val;\n        this.asyncRenderComplete?.resolve();\n      });\n    } else {\n      // Synchronously update the value to render.\n      this.valueToRender = getBooleanSync(place, placeField);\n    }\n  }\n\n  private resetAsyncRenderPromise() {\n    this.asyncRenderComplete?.resolve();\n    this.asyncRenderComplete = undefined;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'gmpx-place-field-boolean': PlaceFieldBoolean;\n  }\n}\n"]}